<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claims Enrichment Rules Management</title>
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Application JavaScript -->
    <script src="js/app.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/rule-builder.js"></script>
    <style>
        .modal { 
    display: none; 
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 50;
    background-color: rgba(0, 0, 0, 0.5);
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
    /* Prevent background scroll */
    overscroll-behavior: contain;
}

.modal.show { 
    display: flex; 
    align-items: flex-start;
    justify-content: center;
    /* Ensure modal starts at top with some padding */
    padding-top: 40px;
}

/* Prevent body scroll when modal is open */
body.modal-open {
    overflow: hidden;
    height: 100vh;
}

/* Enhanced modal content positioning */
.modal .bg-white {
    position: relative;
    margin: auto 0;
    min-height: 0; /* Allow flexbox to work properly */
}

/* Better scrolling for modal content */
.modal .overflow-y-auto {
    max-height: calc(90vh - 120px); /* Account for header and footer */
}

.filter-badge {
    animation: slideIn 0.2s ease-out;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}

.collapse {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.expand {
    max-height: 500px;
    transition: max-height 0.3s ease-in;
}
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6">
        <!-- Simplified Header - NO PBM selector, NO New Rule button -->
        <div class="bg-white rounded-lg border p-6 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Claims Enrichment Rules</h1>
                    <p class="text-gray-600 mt-2">Manage your claim enrichment business rules across PBMs</p>
                </div>
            </div>
        </div>

        <!-- Filters Container - Load dynamically -->
        <div id="filters-container" 
             hx-get="https://bef4xsajbb.execute-api.us-east-1.amazonaws.com/dev/rules?component=filters" 
             hx-trigger="load">
            <!-- Filters will load here -->
            <div class="bg-white rounded-lg border p-4">
                <div class="text-center text-gray-500">Loading filters...</div>
            </div>
        </div>

        <!-- Rules Container -->
        <div id="rules-container">
            <div class="bg-white rounded-lg border p-8">
                <div class="text-center text-gray-500">
                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Select Filters to View Rules</h3>
                    <p class="text-gray-500">Use the filters above to load and manage enrichment rules</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for New/Edit Rule -->
    <div id="rule-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-[95vw] w-full h-[100vh] overflow-y-auto">
            <div id="modal-content">
                <!-- Modal content will load here via HTMX -->
            </div>
        </div>
    </div>

    <!-- Notification Area -->
    <div id="notification" class="fixed top-4 right-4 z-50">
        <!-- Success/error messages will appear here -->
    </div>

</body>
</html>